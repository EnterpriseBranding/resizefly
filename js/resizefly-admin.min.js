(function ($) {
function showHideTable(a,b){a?b.show():b.hide()}var resizefly=window.resizefly,buttonIds=["#"+resizefly.purge_id,"#"+resizefly.resized_id];$("#"+resizefly.purge_id+"-smart").on("change",function(){$("#"+resizefly.purge_id+"-text").text($(this).prop("checked")?resizefly.purge_most:resizefly.purge_all)}),$(buttonIds.join(",")).on("click",function(a){a.preventDefault();var b=$(this),c={action:b.attr("id"),_ajax_nonce:b.data("nonce"),"smart-purge":$("#"+b.attr("id")+"-smart").is(":checked")},d="#"+b.attr("id")+"-result";$.post(ajaxurl,c).done(function(a){a.files?$(d).html(resizefly.purge_result).children(".resizefly-files").text(a.files).parent().children(".resizefly-size").text(byteCalc.humanReadable(a.size)):$(d).text(resizefly.purge_empty)}).fail(function(a){alert(a.responseText)})});var byteCalc={};byteCalc.round=function(a,b){var c=Math.pow(10,b),d=a*c;return Math.round(d)/c},byteCalc.humanReadable=function(a){if(0===a)return"0 Byte";var b=["Bytes","KB","MB","GB","TB"],c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return this.round(a/Math.pow(1024,c),2)+" "+b[c]};var $registeredSection=$('label[for="resizefly_sizes_section"]').parents("tr"),$userSection=$('label[for="resizefly_user_sizes"]').parents("tr"),$toggle=$("#resizefly_restrict_sizes");showHideTable($toggle.is(":checked"),$registeredSection),showHideTable($toggle.is(":checked"),$userSection),$toggle.on("change",function(){showHideTable($toggle.is(":checked"),$registeredSection),showHideTable($toggle.is(":checked"),$userSection)});var $=jQuery,resizefly=window.resizefly,unsaved=!1,$error=$("#js-rzf-user-sizes-error"),$add=$("#js-rzf-user-size-add");$(document).keypress(function(a){13===a.which&&$("#rzf-user-sizes").find("input:focus").length&&(a.preventDefault(),$add.trigger("click"))}),$add.on("click",function(a){a.preventDefault();var b,c={},d=$(this);if(d.attr("disabled","disabled"),$error.empty(),d.parent(".rzf-user-sizes-single").siblings(".rzf-user-sizes-single").each(function(){var a=$(this).find('input[name!=""]'),d=a.attr("name").match(/resizefly_user_sizes\[clone]\[([a-z]+?)]/i);if(c[d[1]]=$.trim(a.val()),a[0].reportValidity(),!a[0].checkValidity())return b=d[1],!1;if("name"===d[1]){var e=$(".rzf-size-name").map(function(){return $.trim($(this).text())}).toArray();if($.inArray($.trim(a.val()),e)>-1)return $error.append($("<div>").text(resizefly.user_size_errors.name)),b=d[1],!1}}),b)return void d.removeAttr("disabled");$error.empty(),0===$('input[name="resizefly_user_sizes[clone][name]"]').length&&$error.append($("<div>").text(resizefly.user_size_errors.name)),$.post(window.ajaxurl,{action:d.data("action"),ajax_nonce:d.data("nonce"),size:c}).always(function(a){d.removeAttr("disabled")}).done(function(a){unsaved=!0,a.data.crop="boolean"==typeof a.data.crop?!!a.data.crop:a.data.crop.join(",");var b=wp.template("rzf-size-row"),c=0;$(".rzf-size").each(function(b,d){var e=$(d).data();if(c=b,!(e.width<a.data.width)){if(e.height>a.data.height)return!1;if(!(e.width===a.data.width&&e.height===a.data.height&&e.name<a.data.name))return!1}}),0===c?$(".rzf-image-sizes tbody").prepend(b(a.data)):$(""+b(a.data)).insertAfter(".rzf-size:nth-child("+c+")"),$(".rzf-user-sizes-single").find("input").each(function(){$(this).val("").prop("checked",!1)})}).fail(function(a){$.each(a.responseJSON.data,function(a,b){$error.append($("<div>").text(resizefly.user_size_errors[b]))})})}),$(document).on("click",".js-rzf-user-size-readd",function(a){a.preventDefault();var b=$(this),c=$(this).parents("tr").eq(0);b.attr("disabled","disabled"),$error.empty(),$.post(window.ajaxurl,{action:b.data("action"),ajax_nonce:b.data("nonce"),size:c.data()}).always(function(a){b.removeAttr("disabled")}).done(function(a){unsaved=!0;var b=wp.template("rzf-size-row");$(b(a.data)).insertBefore(c),c.remove(),$(".rzf-size.rzf-size-status-missing").length||$(".rzf-size-status-desc .rzf-size-status-missing").addClass("hidden")}).fail(function(a){$.each(a.responseJSON.data,function(a,b){$error.append($("<div>").text(resizefly.user_size_errors[b]))})})}),$(document).on("click",".js-rzf-user-size-delete",function(a){a.preventDefault();var b=$(this);b.attr("disabled","disabled"),$.post(window.ajaxurl,{action:b.data("action"),ajax_nonce:b.data("nonce"),size:b.data("size-name")}).always(function(a){b.removeAttr("disabled")}).done(function(){b.closest("tr").addClass("rzf-size-status-missing").find("input").each(function(){$(this).remove()}),b.remove(),unsaved=!0}).fail(function(){})}),$("#js-rzf-toggle-crop").on("change",function(){var a=$('[name="resizefly_user_sizes[clone][crop]"]'),b=$("#js-rzf-crop-x"),c=$("#js-rzf-crop-y"),d=b.add(c);this.checked?(d.removeAttr("disabled"),a.val(b.val()+", "+c.val()),d.on("change",function(){a.val(b.val()+", "+c.val())})):(d.attr("disabled","disabled"),a.val(this.checked))}),$("#rzf-size-missing-save").on("click",function(a){a.preventDefault()}),$('form[action="options.php"]').on("submit",function(){unsaved=!1});
})(jQuery);