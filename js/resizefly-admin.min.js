(function ($) {
function showHideTable(a,b){a?b.show():b.hide()}var resizefly=window.resizefly,buttonIds=["#"+resizefly.purge_id,"#"+resizefly.resized_id];$(buttonIds.join(",")).on("click",function(a){a.preventDefault();var b=$(this),c={action:b.attr("id"),_ajax_nonce:b.data("nonce"),"smart-purge":$("#"+b.attr("id")+"-smart").is(":checked")},d="#"+b.attr("id")+"-result";$.post(ajaxurl,c).done(function(a){a.files?$(d).html(resizefly.purge_result).children(".resizefly-files").text(a.files).parent().children(".resizefly-size").text(byteCalc.humanReadable(a.size)):$(d).text(resizefly.purge_empty)}).fail(function(a){alert(a.responseText)})});var byteCalc={};byteCalc.round=function(a,b){var c=Math.pow(10,b),d=a*c;return Math.round(d)/c},byteCalc.humanReadable=function(a){if(0===a)return"0 Byte";var b=["Bytes","KB","MB","GB","TB"],c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return this.round(a/Math.pow(1024,c),2)+" "+b[c]};var $registeredSection=$('label[for="resizefly_sizes_section"]').parents("tr"),$userSection=$('label[for="resizefly_user_sizes"]').parents("tr"),$toggle=$("#resizefly_restrict_sizes");showHideTable($toggle.is(":checked"),$registeredSection),showHideTable($toggle.is(":checked"),$userSection),$toggle.on("change",function(){showHideTable($toggle.is(":checked"),$registeredSection),showHideTable($toggle.is(":checked"),$userSection)});var $=jQuery,resizefly=window.resizefly;$("#js-rzf-add-user-size").on("click",function(a){a.preventDefault();var b={},c=!1;$(this).parent(".rzf-user-sizes-single").siblings(".rzf-user-sizes-single").each(function(){var a=$(this).find('input[name!=""]'),c=a.attr("name").match(/resizefly_user_sizes\[clone\]\[([a-z]+?)\]/i);b[c[1]]=$.trim(a.val())});var d=$("#js-rzf-user-sizes-error"),e=[],f=parseInt(b.width,10)||0,g=parseInt(b.height,10)||0;if(d.empty(),$(".rzf-image-sizes tbody tr td:last-of-type").each(function(){e.push($.trim($(this).text()))}),(0===b.name.length||$.inArray(b.name,e)>-1)&&(d.append($("<div>").text(resizefly.user_size_errors.name)),c=!0),0===f&&0===g&&(d.append($("<div>").text(resizefly.user_size_errors.dimension)),c=!0),!b.crop||"false"===b.crop.toLowerCase()||0!==f&&0!==g||(d.append($("<div>").text(resizefly.user_size_errors.crop_dimensions)),c=!0),c)return!1;$.each(b,function(a,c){$("#js-rzf-user-sizes").append($("<input>").attr({type:"hidden",name:"resizefly_user_sizes["+b.name+"]["+a+"]"}).val(c))}),$("#submit").click()}),$(".js-rzf-delete-user-size").on("click",function(a){a.preventDefault(),$(this).closest("tr").remove(),$("#submit").click()}),$("#js-rzf-toggle-crop").on("change",function(){var a=$('[name="resizefly_user_sizes[clone][crop]"]'),b=$("#js-rzf-crop-x"),c=$("#js-rzf-crop-y"),d=b.add(c);this.checked?(d.removeAttr("disabled"),a.val(b.val()+", "+c.val()),d.on("change",function(){a.val(b.val()+", "+c.val())})):(d.attr("disabled","disabled"),a.val(this.checked))}),$('[name^="resizefly_user_sizes[clone]"').on("keypress keyup",function(a){13===a.which&&(a.preventDefault(),$("#js-rzf-add-user-size").click())});
})(jQuery);