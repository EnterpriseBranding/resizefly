(function ($) {
var buttonIds=["#"+(resizefly=window.resizefly).purge_id,"#"+resizefly.resized_id];$("#"+resizefly.purge_id+"-smart").on("change",function(){$("#"+resizefly.purge_id+"-text").text($(this).prop("checked")?resizefly.purge_most:resizefly.purge_all)}),$(buttonIds.join(",")).on("click",function(e){e.preventDefault();var t=$(this),r={action:t.attr("id"),_ajax_nonce:t.data("nonce"),"smart-purge":$("#"+t.attr("id")+"-smart").is(":checked")},i="#"+t.attr("id")+"-result";$.post(ajaxurl,r).done(function(e){e.files?$(i).html(resizefly.purge_result).children(".resizefly-files").text(e.files).parent().children(".resizefly-size").text(byteCalc.humanReadable(e.size)):$(i).text(resizefly.purge_empty)}).fail(function(e){alert(e.responseText)})});var byteCalc={round:function(e,t){var r=Math.pow(10,t),i=e*r;return Math.round(i)/r},humanReadable:function(e){if(0===e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return this.round(e/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t]}},$registeredSection=$('label[for="resizefly_sizes_section"]').parents("tr"),$userSection=$('label[for="resizefly_user_sizes"]').parents("tr"),$toggle=$("#resizefly_restrict_sizes");function showHideTable(e,t){e?t.show():t.hide()}showHideTable($toggle.is(":checked"),$registeredSection),showHideTable($toggle.is(":checked"),$userSection),$toggle.on("change",function(){showHideTable($toggle.is(":checked"),$registeredSection),showHideTable($toggle.is(":checked"),$userSection)});var $=jQuery,resizefly=window.resizefly,unsaved=!1,$error=$("#js-rzf-user-sizes-error"),$add=$("#js-rzf-user-size-add");$(document).keypress(function(e){13===e.which&&$("#rzf-user-sizes").find("input:focus").length&&(e.preventDefault(),$add.trigger("click"))}),$add.on("click",function(e){e.preventDefault();var i,a={},t=$(this);t.attr("disabled","disabled"),$error.empty(),t.parent(".rzf-user-sizes-single").siblings(".rzf-user-sizes-single").each(function(){var e=$(this).find('input[name!=""]'),t=e.attr("name").match(/resizefly_user_sizes\[clone]\[([a-z]+?)]/i);if(a[t[1]]=$.trim(e.val()),e[0].reportValidity(),!e[0].checkValidity())return i=t[1],!1;if("name"===t[1]){var r=$(".rzf-size-name").map(function(){return $.trim($(this).text())}).toArray();if(-1<$.inArray($.trim(e.val()),r))return $error.append($("<div>").text(resizefly.user_size_errors.name)),i=t[1],!1}}),i?t.removeAttr("disabled"):($error.empty(),0===$('input[name="resizefly_user_sizes[clone][name]"]').length&&$error.append($("<div>").text(resizefly.user_size_errors.name)),$.post(window.ajaxurl,{action:t.data("action"),ajax_nonce:t.data("nonce"),size:a}).always(function(e){t.removeAttr("disabled")}).done(function(i){unsaved=!0,i.data.crop="boolean"==typeof i.data.crop?!!i.data.crop:i.data.crop.join(",");var e=wp.template("rzf-size-row"),a=0;$(".rzf-size").each(function(e,t){var r=$(t).data();if(a=e,!(r.width<i.data.width)){if(r.height>i.data.height)return!1;if(!(r.width===i.data.width&&r.height===i.data.height&&r.name<i.data.name))return!1}}),0===a?$(".rzf-image-sizes tbody").prepend(e(i.data)):$(""+e(i.data)).insertAfter(".rzf-size:nth-child("+a+")"),$(".rzf-user-sizes-single").find("input").each(function(){$(this).val("").prop("checked",!1)})}).fail(function(e){$.each(e.responseJSON.data,function(e,t){$error.append($("<div>").text(resizefly.user_size_errors[t]))})}))}),$(document).on("click",".js-rzf-user-size-readd",function(e){e.preventDefault();var t=$(this),r=$(this).parents("tr").eq(0);t.attr("disabled","disabled"),$error.empty(),$.post(window.ajaxurl,{action:t.data("action"),ajax_nonce:t.data("nonce"),size:r.data()}).always(function(e){t.removeAttr("disabled")}).done(function(e){unsaved=!0;var t=wp.template("rzf-size-row");$(t(e.data)).insertBefore(r),r.remove(),$(".rzf-size.rzf-size-status-missing").length||$(".rzf-size-status-desc .rzf-size-status-missing").addClass("hidden")}).fail(function(e){$.each(e.responseJSON.data,function(e,t){$error.append($("<div>").text(resizefly.user_size_errors[t]))})})}),$(document).on("click",".js-rzf-user-size-delete",function(e){e.preventDefault();var t=$(this);t.attr("disabled","disabled"),$.post(window.ajaxurl,{action:t.data("action"),ajax_nonce:t.data("nonce"),size:t.data("size-name")}).always(function(e){t.removeAttr("disabled")}).done(function(){t.closest("tr").addClass("rzf-size-status-missing").find("input").each(function(){$(this).remove()}),t.remove(),unsaved=!0}).fail(function(){})}),$("#js-rzf-toggle-crop").on("change",function(){var e=$('[name="resizefly_user_sizes[clone][crop]"]'),t=$("#js-rzf-crop-x"),r=$("#js-rzf-crop-y"),i=t.add(r);this.checked?(i.removeAttr("disabled"),e.val(t.val()+", "+r.val()),i.on("change",function(){e.val(t.val()+", "+r.val())})):(i.attr("disabled","disabled"),e.val(this.checked))}),$("#rzf-size-missing-save").on("click",function(e){e.preventDefault()}),$('form[action="options.php"]').on("submit",function(){unsaved=!1});
})(jQuery);